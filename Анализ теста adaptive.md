## Анализ теста adaptive

### Реальные данные:

На момент 12.03.2025:

Процент опозданий при работе adaptive составляет: 6.13%
Процент опозданий без работы adaptive составляет: 4.93%

Посчитаем разницу или же uplift:

$$\text{uplift (\%)} = \frac{\text{test} - \text{control}}{\text{control}} \times 100\% = 24.26\%$$

Очистим clik-to-eat от слотовых и возвратов и получим:

Средний click-to-eat при работе adaptive: 24.98 минут
Средний click-to-eat без работы adaptive: 24.29 минут

$$\text{uplift (\%)} = \frac{\text{test} - \text{control}}{\text{control}} \times 100\% = 2.81\%$$

Цель последующего исследования понять, что вызвало рост процента опозданий
### Иерархическая линейная модель:

Выберу биномиальный likelihood для оценки процента опозданий по часам на тестовом дарксторе и в качестве предикторов буду использовать: час, суммарную дистанцию, которую проехали курьеры, количество заказов, день недели

![[Pasted image 20250314160649.png]]

Проверим на сколько точно модель предсказывает априоры:

<img src="Pasted image 20250314160749.png" width="100%">

Видно, что модель правильно специфицирована. Перейдем к сэмплированию значений и оценке коэффициентов:

![[Pasted image 20250314160807.png]]

Посмотрим на полученный коэффициент при переменной означающей наличие теста или его отсутсвие:

![[Pasted image 20250314161100.png]]

В среднем beta_test равняется 0.161 c 97% вероятностью можно сказать, что эффект был от [-2% до 37%]. Со средним эффектом:

$$\text{uplift (\%)} = \left(e^{\beta_{\text{test}}} - 1\right) \times 100 = 17.4\%$$

### R2D2 модель с non-centered параметризацией:

Модель основана на статье [https://arxiv.org/abs/2208.07132](https://arxiv.org/abs/2208.07132) . Суть заключается в том, что мы используем R^2 в качестве приора для оценки, в данной ситуации задал его на уровне 0.5, поскольку неуверен в качестве данных и потенциальном результате. Выглядит она следующим образом:

![[Pasted image 20250314161530.png]]

Убедимся в том, что априорные оценки соответствуют действительности:

![[Pasted image 20250314161545.png]]

Оценим коэффициенты модели:

![[Pasted image 20250314161600.png]]

Получили оценку R^2 на уровне 0.95, что говорит о том, что модель хорошо зафитилась. Посмотрим на коэффициент перед переменной сигнализирующей о наличии теста на ДС:

![[Pasted image 20250314161643.png]]

С 97% доверительным интервалом [-2% до 41%] получили, что в среднем beta_test = 0.166. В среднем получили эффект:

$$\text{uplift (\%)} = \left(e^{\beta_{\text{test}}} - 1\right) \times 100 = 18.05\%$$

### Оценка и интерпритация промежуточных результатов:

При оценке моделей R2D2 выигрывает по метрике [Leave-one-out Cross-validation (LOO)](https://www.pymc.io/projects/docs/en/stable/learn/core_notebooks/model_comparison.html), следовательно на ее результаты будем обращать внимание в первую очередь и в последующих тестах по возможности буду использовать ее в приоритете:

Можно сделать вывод о том, что при включении adaptive на данном кластере привело к росту **процента опозданий приблизительно на 17 - 18%**

Далее по тексту проведу аналогичное исследование для метрик click-to-eat и проценту опозданий.

### Рассмотрим утилизацию курьера:

![[Pasted image 20250314162111.png]]

Заметим, что в среднем курьеры стали работать на данном кластере на -0.52% меньше. Посмотрим на количество курьеров:

![[Pasted image 20250314162225.png]]

Видно, что количество курьеров снизилось на -2.52%. Посмотрим на количество заказов на курьера:

![[Pasted image 20250314162238.png]]

Количество заказов на курьера выросло на 8.16%

### Промежуточные итоги:

- Курьеры стали работать на данном кластере на -0.52% меньше часов
    
- Количество курьеров снизилось на -2.52%
    
- Количество заказов на курьера выросло на 8.16%
    
### Учтем в оценке эффекта снижение количества курьеров и снижение времени работы:

#### Оценим количество опозданий, учитывая количество курьеров

Усложним модель и учтем количество курьеров:

![[Pasted image 20250314162601.png]]
![[Pasted image 20250314162413.png]]

Можно заметить, что модель стала лучше улавливать таргет - количество опозданий. Получим следующую оценку при тестовом коэффициенте: 0.09 с 97% вероятностью, что результат [от -7% до 22%]. Если интерпритировать улучшенную модель, то она подозревает, что % опозданий вырос всего на 9%.

![[Pasted image 20250314162649.png]]

#### Оценим click-to-eat, учитывая количество курьеров

Была сделана упрощенная модель:

![[Pasted image 20250314163026.png]]
Если посмотреть на оценку коэффициента перед тестовой переменной, то он составил 0.01 или же 1% эффекта на увеличение click-to-eat. С 97% вероятностью рост составил [от 0% до 3%]
### Финальные выводы:

Данных за время теста было немного, поэтому пришлось строить страшные модели.

**Улучшил ли адаптив click-to-eat и %опозданий или ухудшил?**

- Определенно сказать нельзя, поскольку во время теста изменилось количество курьеров на -2.52%, время работы курьеров на данном кластере снизилось на -0.52%, но можно отметить, что и количество заказов на курьера выросло на 8.16%
    

**Повлияло ли снижение количества курьеров на результаты?**

- Да, повлияло. Можно заметить, что модель, которая не учитывает количество курьеров видит рост % опозданий порядка 18%, а если учесть количество курьеров, то модель занижает оценки до 9%. Однозначно интерпретировать данные результаты нельзя. Нужно проводить дальше тест, чтобы можно было более точно оценить результат.
    

**Как сделать результат от тестов более прозрачным?**

- Следить в моменте за количеством курьеров и если их количество снижается, то собирать обратную связь и возможно проводить дополнительное вознаграждение

- Количество заказов на курьера выросло на 8%, как следствие это могло вызвать рост числа процента опозданий


**Ссылки на используемую информацию:**

- [https://ferres.ml/en/posts/2023/r2d2m2/post.html](https://ferres.ml/en/posts/2023/r2d2m2/post.html)
    
- [https://www.pymc.io/projects/examples/en/latest/generalized_linear_models/GLM-binomial-regression.html](https://www.pymc.io/projects/examples/en/latest/generalized_linear_models/GLM-binomial-regression.html)
    

---